import datetime
from flask import Flask, app, jsonify

app = Flask(__name__)


class Flight:
    def __init__(self, fid, arrival, departure, success):
        self.fid = fid
        self.arrival = arrival
        self.departure = departure
        self.success = success

    def jsonify(self):
        return {
            "fid": self.fid,
            "arrival": self.arrival,
            "departure": self.departure,
            "success": self.success,
        }


def get_updated_flight_status(time_diff: str, success_threshold: int) -> list:
    flights = []
    counter = 0
    iteration = 0
    raw_data2 = ['A12', '09:00', '13:00',
                 'A14', '12:00', '19:00',
                 'B15', '10:00', '13:00',
                 'C124', '14:00', '16:00',
                 'C23', '08:00', '17:00',
                 'B12', '13:01', '16:00',
                 'G56', '09:30', '14:00',
                 'B35', '16:01', '20:00',
                 'A21', '08:00', '13:00',
                 'A19', '17:00', '19:00',
                 'B55', '11:00', '13:00',
                 'C128', '12:00', '16:00',
                 'C26', '08:00', '17:00',
                 'B52', '12:01', '16:00',
                 'G86', '07:30', '14:00',
                 'B65', '17:01', '20:00',
                 'B05', '10:00', '14:00',
                 'C1223', '12:55', '16:00',
                 'C235', '08:00', '22:00',
                 'B46', '14:01', '16:00',
                 'G88', '09:30', '14:00',
                 'B39', '16:01', '20:00',
                 'G88', '11:30', '14:05',
                 'B39', '16:01', '20:00']
    raw_data = ['A12', '09:00', '13:00',
                'A14', '12:00', '19:00',
                'B15', '10:00', '13:00',
                'C124', '14:00', '16:00',
                'C23', '08:00', '17:00',
                'B12', '13:01', '16:00',
                'G56', '09:30', '14:00',
                'B35', '16:01', '20:00',
                'A21', '08:00', '13:00',
                'A19', '17:00', '19:00',
                'B55', '11:00', '13:00',
                'C128', '12:00', '16:00',
                'C26', '08:00', '17:00',
                'B52', '12:01', '16:00',
                'G86', '07:30', '14:00',
                'B65', '17:01', '20:00',
                'B05', '10:00', '14:00',
                'C1223', '12:55', '16:00',
                'C235', '08:00', '22:00',
                'B46', '14:01', '16:00',
                'G88', '09:30', '14:00',
                'B39', '16:01', '20:00',
                'G88', '11:30', '14:05',
                'B39', '16:01', '20:00',
                'A12', '09:00', '13:00',
                'A14', '12:00', '19:00',
                'B15', '10:00', '13:00',
                'C124', '14:00', '16:00',
                'C23', '08:00', '17:00',
                'B12', '13:01', '16:00',
                'G56', '09:30', '14:00',
                'B35', '16:01', '20:00',
                'A21', '08:00', '13:00',
                'A19', '17:00', '19:00',
                'B55', '11:00', '13:00',
                'C128', '12:00', '16:00',
                'C26', '08:00', '17:00',
                'B52', '12:01', '16:00',
                'G86', '07:30', '14:00',
                'B65', '17:01', '20:00',
                'B05', '10:00', '14:00',
                'C1223', '12:55', '16:00',
                'C235', '08:00', '22:00',
                'B46', '14:01', '16:00',
                'G88', '09:30', '14:00',
                'B39', '16:01', '20:00',
                'G88', '11:30', '14:05',
                'B39', '16:01', '20:00',
                'A12', '09:00', '13:00',
                'A14', '12:00', '19:00',
                'B15', '10:00', '13:00',
                'C124', '14:00', '16:00',
                'C23', '08:00', '17:00',
                'B12', '13:01', '16:00',
                'G56', '09:30', '14:00',
                'B35', '16:01', '20:00',
                'A21', '08:00', '13:00',
                'A19', '17:00', '19:00',
                'B55', '11:00', '13:00',
                'C128', '12:00', '16:00',
                'C26', '08:00', '17:00',
                'B52', '12:01', '16:00',
                'G86', '07:30', '14:00',
                'B65', '17:01', '20:00',
                'B05', '10:00', '14:00',
                'C1223', '12:55', '16:00',
                'C235', '08:00', '22:00',
                'B46', '14:01', '16:00',
                'G88', '09:30', '14:00',
                'B39', '16:01', '20:00',
                'G88', '11:30', '14:05',
                'B39', '16:01', '20:00',
                'A12', '09:00', '13:00',
                'A14', '12:00', '19:00',
                'B15', '10:00', '13:00',
                'C124', '14:00', '16:00',
                'C23', '08:00', '17:00',
                'B12', '13:01', '16:00',
                'G56', '09:30', '14:00',
                'B35', '16:01', '20:00',
                'A21', '08:00', '13:00',
                'A19', '17:00', '19:00',
                'B55', '11:00', '13:00',
                'C128', '12:00', '16:00',
                'C26', '08:00', '17:00',
                'B52', '12:01', '16:00',
                'G86', '07:30', '14:00',
                'B65', '17:01', '20:00',
                'B05', '10:00', '14:00',
                'C1223', '12:55', '16:00',
                'C235', '08:00', '22:00',
                'B46', '14:01', '16:00',
                'G88', '09:30', '14:00',
                'B39', '16:01', '20:00',
                'G88', '11:30', '14:05',
                'B39', '16:01', '20:00'
                ]

    for i in range(0, len(raw_data), 3):
        fid = raw_data[i:i + 3].__getitem__(0)
        departure = raw_data[i:i + 3].__getitem__(1)
        arrival = raw_data[i:i + 3].__getitem__(2)
        arrival_time = datetime.datetime.strptime(arrival, '%H:%M')
        departure_time = datetime.datetime.strptime(departure, '%H:%M')
        time_delta = datetime.datetime.strptime(time_diff, '%H:%M') - datetime.datetime.strptime('00:00', '%H:%M')
        if arrival_time - departure_time > time_delta or counter >= success_threshold:
            flights.append(Flight(fid, arrival, departure, False).jsonify())
        else:
            flights.append(Flight(fid, arrival, departure, True).jsonify())
            counter = counter + 1
        iteration = iteration + 1
    return flights


@app.route('/Flights', methods=['GET'])
def get_flights():
    return get_updated_flight_status('03:00', 20)


if __name__ == '__main__':
    app.run(debug=True)
    updated_flights = get_updated_flight_status('03:00', 20)
    print(updated_flights)
